angular.module("sample",["ngRoute","ngCkeditor","sample.user","sample.search","sample.common","sample.detail","ui.bootstrap","gd.ui.jsonexplorer","sample.create"]).config(["$routeProvider","$locationProvider",function(e,t){"use strict";t.html5Mode(!0),e.when("/",{templateUrl:"/search/search.html"}).when("/create",{templateUrl:"/create/create.html",controller:"CreateCtrl"}).when("/detail",{templateUrl:"/detail/detail.html",controller:"DetailCtrl"}).when("/profile",{templateUrl:"/user/profile.html",controller:"ProfileCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("sample.common",[]),function(){"use strict";angular.module("sample.detail").controller("DetailCtrl",["$scope","MLRest","$routeParams",function(e,t,r){var a=r.uri,n={detail:{}};t.getDocument(a,{format:"json"}).then(function(e){n.detail=e.data}),angular.extend(e,{model:n})}])}(),angular.module("sample.detail",[]),angular.module("sample.create").directive("compile",function(e){"use strict";return function(t,r,a){t.$watch(function(e){return e.$eval(a.compile)},function(a){r.html(a),e(r.contents())(t)})}}),function(){"use strict";angular.module("sample.create").controller("CreateCtrl",["$scope","MLRest","Features","$window",function(e,t,r,a){var n={demo:{name:"",description:"",host:"",hostType:"internal",browsers:[],features:[],languages:[],bugs:[],comments:[]},featureChoices:r.list(),browserChoices:["Firefox","Chrome","IE"]};angular.extend(e,{model:n,editorOptions:{height:"100px",toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"basicstyles",groups:["basicstyles","cleanup"]}],toolbar:"",toolbar_full:""},updateBrowsers:function(t){var r=e.model.demo.browsers.indexOf(t);r>-1?e.model.demo.browsers.splice(r,1):e.model.demo.browsers.push(t)},submit:function(){t.createDocument(e.model.demo,{format:"json",directory:"/demos/",extension:".json","perm:demo-cat-role":"read","perm:demo-cat-registered-role":"update"}).then(function(e,t,r){a.location.href="/detail?uri="+r("location").replace(/(.*\?uri=)/,"")})}})}])}(),angular.module("sample.create",[]),function(){"use strict";var e=angular.module("sample.search");e.directive("facets",[function(){return{restrict:"E",scope:{facets:"=facetList",selected:"=selected",select:"&select",clear:"&clear"},templateUrl:"/search/facets-dir.html",link:function(){}}}])}(),function(){"use strict";var e=angular.module("sample.search");e.directive("results",[function(){return{restrict:"E",scope:{results:"=resultList",total:"=total",start:"=start",pageLength:"=pageLength",currentPage:"=currentPage",paginate:"&paginate",updateQuery:"&updateQuery"},templateUrl:"/search/results-dir.html",link:function(e){e.Math=window.Math}}}])}(),function(){"use strict";angular.module("sample.search").controller("SearchCtrl",["$scope","MLRest","User","$location",function(e,t,r,a){function n(e){o.search=e}var o={selected:[],text:"",user:r},s=t.createSearchContext();!function(){s.search().then(n)}(),angular.extend(e,{model:o,selectFacet:function(e,t){var r=o.selected.filter(function(r){return r.facet===e&&r.value===t});0===r.length&&(o.selected.push({facet:e,value:t}),s.selectFacet(e,t).search().then(n))},clearFacet:function(e,t){var r;for(r=0;r<o.selected.length;r++)if(o.selected[r].facet===e&&o.selected[r].value===t){o.selected.splice(r,1);break}s.clearFacet(e,t).search().then(n)},textSearch:function(){s.setText(o.text).search().then(n),a.path("/")},pageChanged:function(e){s.setPage(e,o.pageLength).search().then(n)}}),e.$watch("model.user.authenticated",function(){s.search().then(n,function(){o.search={}})})}])}(),angular.module("sample.search",[]),function(){"use strict";angular.module("sample.user").controller("ProfileCtrl",["$scope","MLRest","User","$location",function(e,t,r,a){var n={user:r,newEmail:""};angular.extend(e,{model:n,addEmail:function(){e.profileForm.newEmail.$error.email||(e.model.user.emails||(e.model.user.emails=[]),e.model.user.emails.push(n.newEmail),n.newEmail="")},removeEmail:function(t){e.model.user.emails.splice(t,1)},submit:function(){t.updateDocument({user:{fullname:e.model.user.fullname,emails:e.model.user.emails}},{format:"json",uri:"/users/"+e.model.user.name+".json","perm:demo-cat-role":"read","perm:demo-cat-registered-role":"update"}).then(function(){a.path("/")})}})}])}(),function(){"use strict";var e=angular.module("sample.user");e.directive("mlUser",[function(){return{restrict:"A",controller:"UserController",replace:!0,scope:{username:"=username",password:"=password",authenticated:"=authenticated",login:"&login",logout:"&logout",loginerror:"=loginerror"},templateUrl:"/user/user-dir.html",link:function(){}}}]).controller("UserController",["$scope","User","$http","$location",function(e,t,r,a){angular.extend(e,{login:function(e,n){r.get("/user/login",{params:{username:e,password:n}}).then(function(e){t.authenticated=e.data.authenticated,t.authenticated===!0?(t.loginError=!1,void 0!==e.data.profile?(t.fullname=e.data.profile.fullname,t.emails=e.data.profile.emails):a.path("/profile")):t.loginError=!0})},logout:function(){r.get("/user/logout",{}).then(function(){t.init()})}})}])}(),function(){"use strict";angular.module("sample.user").factory("User",["$http",function(e){function t(e){var t=e.data;t.authenticated===!0&&(r.name=t.username,r.authenticated=!0,void 0!==t.profile&&(r.hasProfile=!0,r.fullname=t.profile.fullname,r.emails=$.isArray(t.profile.emails)?t.profile.emails:[t.profile.emails]))}var r={};return e.get("/user/status",{}).then(t),r.init=function(){return r.name="",r.password="",r.loginError=!1,r.authenticated=!1,r.hasProfile=!1,r.fullname="",r.emails=[],r},r}])}(),angular.module("sample.user",["sample.common"]),function(){"use strict";angular.module("sample.common").provider("MLRest",function(){function e(e){var t,r,a,n,o=[],s={};for(var u in e)if(e.hasOwnProperty(u)){s={};for(n in e[u])if(e[u].hasOwnProperty(n))if("metadata"===n){t={};for(r in e[u].metadata)if(e[u].metadata.hasOwnProperty(r))for(a in e[u].metadata[r])e[u].metadata[r].hasOwnProperty(a)&&(t[a]?t[a].push(e[u].metadata[r][a]):t[a]=[e[u].metadata[r][a]]);s.metadata=t}else s[n]=e[u][n];o.push(s)}return o}function t(t,r,a){function n(){var n=r.defer();return a.get("/v1/search",{params:{format:"json",options:t.queryOptions,structuredQuery:s(),start:d,pageLength:t.pageLength}}).success(function(t){t.results=e(t.results),n.resolve(t)}).error(function(e){n.reject(e)}),n.promise}function o(e){var r;for(r in l)l.hasOwnProperty(r)&&l[r].length>0&&e.push("Dataset"===r?{"collection-constraint-query":{"constraint-name":"Dataset",uri:[l[r]]}}:void 0!==t.customConstraintNames&&t.customConstraintNames.indexOf(r)>-1?{"custom-constraint-query":{"constraint-name":r,value:l[r]}}:{"range-constraint-query":{"constraint-name":r,value:l[r]}})}function s(){var e,r=[];return o(r),null!==i&&r.push({qtext:i}),e=u.length>0?{query:{queries:[{"boost-query":{"matching-query":{"and-query":{queries:r}},"boosting-query":{"and-query":{queries:u}}}}]}}:{query:{queries:[{"and-query":{queries:r}}]}},t.includeProperties&&(e={query:{queries:[{"or-query":{queries:[e,{"properties-query":e}]}}]}}),m&&e.query.queries.push({"operator-state":{"operator-name":"sort","state-name":m}}),c&&e.query.queries.push({"operator-state":{"operator-name":"results","state-name":c}}),e}t=t||{};var u=[],l={},i=null,c="compact",m=null,d=1;return function(){t.queryOptions=t.queryOptions?t.queryOptions:"all",t.pageLength=t.pageLength?t.pageLength:10}(),{selectFacet:function(e,t){return void 0===l.facet?l[e]=[t]:l[e].push(t),this},clearFacet:function(e,t){return l[e]=l[e].filter(function(e){return e!==t}),this},clearAllFacets:function(){return l={},this},getQueryOptions:function(){return t.queryOptions},getStructuredQuery:s,search:function(){return n()},setText:function(e){return i=""!==e?e:null,this},setPage:function(e){return d=1+(e-1)*t.pageLength,this},sortBy:function(e){return m=e,this}}}this.$get=function(e,r){var a={createSearchContext:function(a){return new t(a,e,r)},getDocument:function(e,t){return(void 0===t||null===t)&&(t={}),angular.extend(t,{format:"json",uri:e}),r.get("/v1/documents",{params:t})},createDocument:function(e,t){return r.post("/v1/documents",e,{params:t})},updateDocument:function(t,a){var n=e.defer();return r.put("/v1/documents",t,{params:a}).success(function(e,t,r){n.resolve(r("location"))}).error(function(e){n.reject(e)}),n.promise},patch:function(t,a){var n=e.defer();return r.post("/v1/documents",a,{params:{uri:t},headers:{"X-HTTP-Method-Override":"PATCH","Content-Type":"application/json"}}).success(function(e,t,r){n.resolve(r("location"))}).error(function(e){n.reject(e)}),n.promise},advancedCall:function(t,a){var n=e.defer(),o=a.method,s="GET"===o||"PUT"===o||"POST"===o||"DELETE"===o;return o=s?o:"POST",s||(a.headers=a.headers||{},a.headers["X-HTTP-Method-Override"]=a.method),r({url:t,data:a.data,method:o,params:a.params,headers:a.headers}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},callExtension:function(e,t){return this.advancedCall("/v1/resources/"+e,t)}};return a}})}();